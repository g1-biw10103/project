<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Course Details</title>

    <link rel="stylesheet" href="/css/common.css" />
    <link rel="stylesheet" href="/css/course-catalog.css" />
    <link rel="stylesheet" href="/css/detail-course.css" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="topbar">
      <a href="/pages/homepage.html" class="icon-button">
        <img src="/images/icon.png" width="64" height="64" />
      </a>
      <a href="/pages/homepage.html" class="topbar-button">Home</a>
      <a href="/pages/course-catalog.html" class="topbar-button"
        >Course Catalog</a
      >
      <a href="/pages/progress.html" class="topbar-button">Progress Tracker</a>
      <a href="/pages/forum.html" class="topbar-button">Community</a>
      <a href="/pages/dashboard.html" class="topbar-button">Dashboard</a>
      <div class="nav-right">
        <a href="/pages/login.html" class="btn-outline">Log in</a>
        <a href="/pages/signup.html" class="btn-primary">Sign up</a>
      </div>
    </div>

    <div class="container">
      <div class="main-content">
        <section class="course-card" id="course-card">
          <img id="course-logo" src="" alt="Course Logo" class="course-logo" />

          <div class="course-content">
            <h2 id="course-title"></h2>
            <h3 id="course-subtitle"></h3>
            <p id="course-description"></p>

            <p id="course-category"></p>
            <p id="course-instructor"></p>
            <p id="course-rating"></p>
            <p id="course-credits"></p>
            <a
              href="enrollment-system.html"
              id="enroll-button"
              class="btn-secondary"
              style="
                margin-top: auto;
                font-size: 14px;
                padding: 12px 20px;
                width: 100%;
              "
              >Enroll Course</a
            >
          </div>
        </section>
        <section class="modules" id="modules">
          <!-- Modules will be populated by JavaScript -->
        </section>
      </div>
    </div>

    <script>
      // Get course ID from URL parameter
      const urlParams = new URLSearchParams(window.location.search);
      const courseId = urlParams.get("id");

      if (courseId) {
        // Load course data
        fetch("/pages/courses.json")
          .then((response) => {
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
          })
          .then((data) => {
            if (!data.courses) {
              throw new Error(
                "Invalid JSON structure: missing 'courses' property"
              );
            }
            const course = data.courses[courseId];
            if (course) {
              // Update enroll button with course ID
              document.getElementById(
                "enroll-button"
              ).href = `enrollment-system.html?id=${courseId}`;

              // Populate course card
              document.getElementById("course-logo").src = course.logo;
              document.getElementById("course-title").textContent =
                course.title;
              document.getElementById("course-subtitle").textContent =
                course.subtitle;
              document.getElementById("course-description").textContent =
                course.description;
              document.getElementById(
                "course-category"
              ).textContent = `Category: ${course.category}`;
              document.getElementById(
                "course-instructor"
              ).textContent = `Instructor: ${course.instructor}`;
              document.getElementById(
                "course-rating"
              ).textContent = `Rating: ${course.rating}`;
              document.getElementById(
                "course-credits"
              ).textContent = `Credit Hours: ${course.creditHours}`;

              // Populate modules
              const modulesContainer = document.getElementById("modules");
              course.modules.forEach((module) => {
                const moduleCard = document.createElement("div");
                moduleCard.className = "module-card";
                moduleCard.innerHTML = `
                  <h3>${module.title}</h3>
                  <p>${module.description}</p>
                  <a href="${module.previewUrl}" target="_blank" class="btn-primary">Preview</a>
                `;
                modulesContainer.appendChild(moduleCard);
              });
            } else {
              document.querySelector(
                ".main-content"
              ).innerHTML = `<p>Course "${courseId}" not found in database.</p>`;
            }
          })
          .catch((error) => {
            console.error("Error loading course data:", error);
            document.querySelector(
              ".main-content"
            ).innerHTML = `<p>Error loading course data: ${error.message}</p><p style="font-size: 12px; color: #666; margin-top: 10px;">Make sure to access this page through a web server (not file://) and that courses.json exists in the same directory.</p>`;
          });
      } else {
        document.querySelector(".main-content").innerHTML =
          "<p>No course specified. Please click 'View Details' from the course catalog.</p>";
      }
    </script>
  </body>
</html>
